# =============================================================================
# KK-Image Wrangler é…ç½®æ–‡ä»¶
# å‚è€ƒ: https://developers.cloudflare.com/pages/functions/wrangler-configuration/
# =============================================================================

name = "telegraph-image"
compatibility_date = "2025-01-01"
pages_build_output_dir = "./dist"

# å…¼å®¹æ€§æ ‡å¿— - nodejs_compat å¯ç”¨ Node.js å…¼å®¹ API
compatibility_flags = ["nodejs_compat"]

# =============================================================================
# Smart Placement - è‡ªåŠ¨ä¼˜åŒ– Functions ä½ç½®ä»¥å‡å°‘ D1/R2 è®¿é—®å»¶è¿Ÿ
# =============================================================================
[placement]
mode = "smart"

# =============================================================================
# ç¯å¢ƒå˜é‡é…ç½®
# =============================================================================
[vars]

# -----------------------------------------------------------------------------
# ğŸ”§ å­˜å‚¨é…ç½®ï¼ˆå¿…éœ€é€‰æ‹©å…¶ä¸€ï¼‰
# -----------------------------------------------------------------------------

# å­˜å‚¨æ¨¡å¼ï¼šsingleï¼ˆå•ä¸€ï¼‰, smartï¼ˆæ™ºèƒ½è·¯ç”±ï¼‰, redundantï¼ˆå†—ä½™å¤‡ä»½ï¼‰
STORAGE_MODE = "single"

# ä¸»å­˜å‚¨æä¾›è€…ï¼štelegram, r2, s3
# - telegram: ä½¿ç”¨ Telegram Bot APIï¼ˆéœ€é…ç½® TG_Bot_Token å’Œ TG_Chat_IDï¼‰
# - r2: ä½¿ç”¨ Cloudflare R2ï¼ˆéœ€é…ç½® R2 æ¡¶ç»‘å®šï¼‰
# - s3: ä½¿ç”¨ S3 å…¼å®¹æœåŠ¡ï¼ˆéœ€é…ç½® S3_* å˜é‡ï¼‰
STORAGE_PROVIDER = "r2"
STORAGE_PRIMARY = "r2"

# -----------------------------------------------------------------------------
# ğŸ“¦ Telegram å­˜å‚¨é…ç½®ï¼ˆä½¿ç”¨ telegram å­˜å‚¨æ—¶å¿…éœ€ï¼‰
# -----------------------------------------------------------------------------

# Telegram Bot Token - é€šè¿‡ @BotFather è·å–
# æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒè¯·é€šè¿‡ Cloudflare Dashboard è®¾ç½®ï¼Œä¸è¦ç›´æ¥å†™åœ¨æ­¤æ–‡ä»¶
TG_Bot_Token = ""
TG_Chat_ID = ""

# -----------------------------------------------------------------------------
# â˜ï¸ S3 å…¼å®¹å­˜å‚¨é…ç½®ï¼ˆä½¿ç”¨ s3 å­˜å‚¨æ—¶å¿…éœ€ï¼‰
# -----------------------------------------------------------------------------

S3_ENDPOINT = ""
S3_BUCKET = ""
S3_ACCESS_KEY_ID = ""
S3_SECRET_ACCESS_KEY = ""
S3_REGION = "auto"

# -----------------------------------------------------------------------------
# ğŸ”„ å†—ä½™å’Œå›é€€é…ç½®ï¼ˆå¯é€‰ï¼‰
# -----------------------------------------------------------------------------

# é•œåƒå­˜å‚¨åˆ—è¡¨ï¼ˆå†—ä½™æ¨¡å¼ï¼Œé€—å·åˆ†éš”ï¼‰
STORAGE_MIRRORS = ""

# å¼‚æ­¥é•œåƒï¼štrueï¼ˆåå°åŒæ­¥ï¼Œå¿«é€Ÿå“åº”ï¼‰, falseï¼ˆåŒæ­¥ç­‰å¾…ï¼Œç¡®ä¿ä¸€è‡´ï¼‰
STORAGE_MIRROR_ASYNC = "true"

# æ™ºèƒ½è·¯ç”±è§„åˆ™ï¼ˆJSON æ ¼å¼ï¼ŒSTORAGE_MODE = "smart" æ—¶ç”Ÿæ•ˆï¼‰
# ç¤ºä¾‹: '[{"condition":"size < 5242880","storage":"telegram"},{"default":true,"storage":"r2"}]'
# STORAGE_RULES = ""

# å›é€€è®¾ç½®
STORAGE_FALLBACK_ENABLED = "true"
STORAGE_FALLBACK_CHAIN = "r2,s3,telegram"
STORAGE_FALLBACK_TIMEOUT = "3000"

# -----------------------------------------------------------------------------
# ğŸ” ç®¡ç†å‘˜è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒé€šè¿‡ Dashboard è®¾ç½®ï¼‰
# -----------------------------------------------------------------------------
# æ³¨æ„ï¼šä»¥ä¸‹ä¸ºå ä½ç¬¦ï¼Œç”Ÿäº§ç¯å¢ƒè¯·åœ¨ Cloudflare Dashboard -> Settings -> Environment Variables ä¸­é…ç½®
BASIC_USER = ""
BASIC_PASS = ""

# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»é€šè¿‡ Dashboard è®¾ç½®å®‰å…¨éšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET = ""

# -----------------------------------------------------------------------------
# ğŸ›¡ï¸ åŠŸèƒ½å¼€å…³ï¼ˆå¯é€‰ï¼‰
# -----------------------------------------------------------------------------

# ç™½åå•æ¨¡å¼ï¼šä»…å…è®¸ç™½åå•ä¸­çš„å›¾ç‰‡æ˜¾ç¤º
WhiteList_Mode = "false"

# ç¦ç”¨é¥æµ‹
disable_telemetry = "false"

# å†…å®¹å®¡æŸ¥ API Keyï¼ˆModerateContent.comï¼‰
ModerateContentApiKey = ""

# Sentry é”™è¯¯ç›‘æ§ DSN
SENTRY_DSN = ""

# =============================================================================
# ç”Ÿäº§ç¯å¢ƒé…ç½®
# =============================================================================
[env.production.vars]
COMPRESS_STATIC_ASSETS = "true"
BASIC_USER = "admin"
BASIC_PASS = "123"
JWT_SECRET = "kk-image-jwt-secret-change-in-production"
STORAGE_MODE = "single"
STORAGE_PROVIDER = "r2"
STORAGE_PRIMARY = "r2"
TG_Bot_Token = ""
TG_Chat_ID = ""
S3_ENDPOINT = ""
S3_BUCKET = ""
S3_ACCESS_KEY_ID = ""
S3_SECRET_ACCESS_KEY = ""
S3_REGION = "auto"
STORAGE_MIRRORS = ""
STORAGE_MIRROR_ASYNC = "true"
STORAGE_FALLBACK_ENABLED = "true"
STORAGE_FALLBACK_CHAIN = "r2,s3,telegram"
STORAGE_FALLBACK_TIMEOUT = "3000"
WhiteList_Mode = "false"
disable_telemetry = "false"
ModerateContentApiKey = ""
SENTRY_DSN = ""

# ç”Ÿäº§ç¯å¢ƒ KV å‘½åç©ºé—´ç»‘å®š
[[env.production.kv_namespaces]]
binding = "img_url"
id = "7bedbd0e77b64e548b280114c38a5541"

[[env.production.kv_namespaces]]
binding = "WEBHOOKS_KV"
id = "6ae427ac8290406684dcabf2ca4babac"

[[env.production.kv_namespaces]]
binding = "WEBHOOK_LOGS_KV"
id = "0346979ddffe4b2da2a7ea7e05133167"

# ç”Ÿäº§ç¯å¢ƒ R2 å­˜å‚¨æ¡¶ç»‘å®š
[[env.production.r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "kk-image-storage"

# ç”Ÿäº§ç¯å¢ƒ D1 æ•°æ®åº“ç»‘å®š
[[env.production.d1_databases]]
binding = "DB"
database_name = "kk-image-storage-db"
database_id = "6de591b2-4241-4469-988c-29f51bb871ad"

# =============================================================================
# é¢„è§ˆç¯å¢ƒé…ç½®
# =============================================================================
[env.preview.vars]
COMPRESS_STATIC_ASSETS = "false"
# å¼€å‘ç¯å¢ƒæµ‹è¯•å€¼ï¼ˆä»…ä¾›æœ¬åœ°æµ‹è¯•ï¼‰
TG_Bot_Token = "123456789:ABCdefGHIjklMNOpqrSTUvwxYZ"
TG_Chat_ID = "-1001234567890"
BASIC_USER = "admin"
BASIC_PASS = "123456"

# =============================================================================
# KV å‘½åç©ºé—´ç»‘å®š
# é€šè¿‡ `wrangler kv namespace create <NAME>` åˆ›å»º
# =============================================================================

[[kv_namespaces]]
binding = "img_url"
id = "7bedbd0e77b64e548b280114c38a5541"

[[kv_namespaces]]
binding = "WEBHOOKS_KV"
id = "6ae427ac8290406684dcabf2ca4babac"

[[kv_namespaces]]
binding = "WEBHOOK_LOGS_KV"
id = "0346979ddffe4b2da2a7ea7e05133167"

# =============================================================================
# R2 å­˜å‚¨æ¡¶ç»‘å®š
# é€šè¿‡ `wrangler r2 bucket create <NAME>` åˆ›å»º
# =============================================================================

[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "kk-image-storage"

# =============================================================================
# D1 æ•°æ®åº“ç»‘å®š
# é€šè¿‡ `wrangler d1 create <NAME>` åˆ›å»º
# =============================================================================

[[d1_databases]]
binding = "DB"
database_name = "kk-image-storage-db"
database_id = "6de591b2-4241-4469-988c-29f51bb871ad"
migrations_dir = "migrations"

